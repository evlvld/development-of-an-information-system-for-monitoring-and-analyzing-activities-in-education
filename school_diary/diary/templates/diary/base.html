{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <meta name="color-scheme" content="light dark">
    <meta name="description" content="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É—á–µ—Ç–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π">
    <meta name="keywords" content="—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫, —à–∫–æ–ª–∞, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å, –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è">
    <meta name="author" content="School Diary Team">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="{% block og_title %}–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫{% endblock %}">
    <meta property="og:description" content="{% block og_description %}–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É—á–µ—Ç–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π{% endblock %}">
    <meta property="og:type" content="website">
    <title>{% block title %}–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫{% endblock %}</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'diary/css/wow-effects.css' %}" rel="stylesheet">
    {% block extra_css %}{% endblock %}

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–º—ã
        function debugTheme() {
            console.group('–û—Ç–ª–∞–¥–∫–∞ —Ç–µ–º—ã');
            console.debug('–¢–µ–∫—É—â–∞—è —Ç–µ–º–∞:', document.documentElement.getAttribute('data-theme'));
            console.debug('–¢–µ–º–∞ –≤ localStorage:', localStorage.getItem('theme'));
            console.debug('–°–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞:', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–æ–≤ —Ç–µ–∫—Å—Ç–∞
            const computedStyle = getComputedStyle(document.documentElement);
            console.debug('CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:', {
                textPrimary: computedStyle.getPropertyValue('--text-primary'),
                textSecondary: computedStyle.getPropertyValue('--text-secondary'),
                bgPrimary: computedStyle.getPropertyValue('--bg-primary'),
                bgSecondary: computedStyle.getPropertyValue('--bg-secondary'),
                cardText: computedStyle.getPropertyValue('--card-text'),
                tableText: computedStyle.getPropertyValue('--table-text'),
                formText: computedStyle.getPropertyValue('--form-text')
            });
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
            const elements = {
                body: document.body,
                text: document.querySelector('p'),
                link: document.querySelector('a'),
                button: document.querySelector('button'),
                input: document.querySelector('input'),
                card: document.querySelector('.card'),
                table: document.querySelector('.table'),
                navbar: document.querySelector('.navbar')
            };
            
            for (const [name, element] of Object.entries(elements)) {
                if (element) {
                    const style = window.getComputedStyle(element);
                    console.debug(`${name}:`, {
                        color: style.color,
                        backgroundColor: style.backgroundColor,
                        className: element.className
                    });
                }
            }
            
            console.groupEnd();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
        function checkContrast(color1, color2) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ RGB
            function getRGB(color) {
                const temp = document.createElement('div');
                temp.style.color = color;
                document.body.appendChild(temp);
                const style = window.getComputedStyle(temp);
                const rgb = style.color.match(/\d+/g).map(Number);
                document.body.removeChild(temp);
                return rgb;
            }
            
            // –†–∞—Å—á–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —è—Ä–∫–æ—Å—Ç–∏
            function getLuminance(r, g, b) {
                const [rs, gs, bs] = [r, g, b].map(c => {
                    c = c / 255;
                    return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
                });
                return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
            }
            
            const [r1, g1, b1] = getRGB(color1);
            const [r2, g2, b2] = getRGB(color2);
            const l1 = getLuminance(r1, g1, b1);
            const l2 = getLuminance(r2, g2, b2);
            const contrast = (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
            
            return contrast >= 4.5; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç –¥–ª—è WCAG AA
        }
    </script>
    <script src="{% static 'diary/js/theme-switcher.js' %}" defer></script>
</head>
<body>
    <!-- –ü—Ä–æ–ø—É—Å–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è —Å–∫—Ä–∏–Ω—Ä–∏–¥–µ—Ä–æ–≤ -->
    <a href="#main-content" class="visually-hidden-focusable">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é</a>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <nav class="navbar navbar-expand-lg navbar-dark" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
        <div class="container animate-fade-up">
            <a class="navbar-brand" href="/" aria-label="–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
                <span class="icon" role="img" aria-label="–ò–∫–æ–Ω–∫–∞ –¥–Ω–µ–≤–Ω–∏–∫–∞">üìö</span> –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫
            </a>
            <div class="d-flex align-items-center">
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
                <button class="theme-switcher" onclick="toggleTheme(); debugTheme();" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <span id="theme-icon" role="img" aria-hidden="true">üåô</span>
                </button>
                <button class="navbar-toggler ms-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        {% if user.is_staff %}
                            <li class="nav-item delay-1">
                                <a class="nav-link" href="/admin/" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
                            </li>
                        {% endif %}
                        {% if user.teacher %}
                            <li class="nav-item delay-2">
                                <a class="nav-link" href="/teacher/dashboard/" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —É—á–∏—Ç–µ–ª—è">–ü–∞–Ω–µ–ª—å —É—á–∏—Ç–µ–ª—è</a>
                            </li>
                        {% endif %}
                        {% if user.student %}
                            <li class="nav-item delay-2">
                                <a class="nav-link" href="/student/dashboard/" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —É—á–µ–Ω–∏–∫–∞">–ü–∞–Ω–µ–ª—å —É—á–µ–Ω–∏–∫–∞</a>
                            </li>
                        {% endif %}
                        <li class="nav-item delay-4">
                            <a class="nav-link" href="/logout/" aria-label="–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã">–í—ã—Ö–æ–¥</a>
                        </li>
                    {% else %}
                        <li class="nav-item delay-1">
                            <a class="nav-link" href="/login/" aria-label="–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É">–í—Ö–æ–¥</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="py-4" id="main-content" role="main">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        {% if messages %}
            <div class="container mb-4" aria-live="polite">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} animate-slide-left delay-{{ forloop.counter }}" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer class="footer mt-auto py-3" role="contentinfo">
        <div class="container text-center animate-fade-up">
            <span class="text-muted">¬© {% now "Y" %} –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</span>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
    
    <script>
        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            debugTheme();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const textElements = document.querySelectorAll('body, p, span, div, h1, h2, h3, h4, h5, h6, a, button, input, select, textarea');
            textElements.forEach(element => {
                const style = window.getComputedStyle(element);
                const hasGoodContrast = checkContrast(style.color, style.backgroundColor);
                if (!hasGoodContrast) {
                    console.warn('–ù–∏–∑–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç:', {
                        element: element.tagName + (element.className ? '.' + element.className : ''),
                        color: style.color,
                        backgroundColor: style.backgroundColor
                    });
                }
            });
        });
    </script>
</body>
</html> 